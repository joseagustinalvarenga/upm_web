server:
  port: ${PORT:8080}

spring:
  application:
    name: institutional

  datasource:
    driver-class-name: org.postgresql.Driver

    # Opción recomendada: definir en Railway una variable JDBC_DATABASE_URL con formato:
    # jdbc:postgresql://HOST:PORT/DB
    url: ${JDBC_DATABASE_URL:jdbc:postgresql://localhost:5432/institutional_db}

    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}

    hikari:
      pool-name: HikariPool-1
      maximum-pool-size: ${DB_POOL_MAX:10}
      minimum-idle: ${DB_POOL_MIN_IDLE:2}
      connection-timeout: ${DB_CONN_TIMEOUT_MS:30000}     # tiempo para obtener conexión del pool
      validation-timeout: ${DB_VALIDATION_TIMEOUT_MS:5000}
      idle-timeout: ${DB_IDLE_TIMEOUT_MS:600000}
      max-lifetime: ${DB_MAX_LIFETIME_MS:1800000}
      keepalive-time: ${DB_KEEPALIVE_MS:300000}

      # Timeouts del driver (útiles por tu "Read timed out")
      data-source-properties:
        connectTimeout: ${PG_CONNECT_TIMEOUT_SEC:10}
        socketTimeout: ${PG_SOCKET_TIMEOUT_SEC:30}
        tcpKeepAlive: true

        # SSL: en muchos providers cloud es requerido.
        # Si tu DB NO usa SSL, poné DB_SSLMODE=disable
        sslmode: ${DB_SSLMODE:require}

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: false
    database-platform: org.hibernate.dialect.PostgreSQLDialect

  flyway:
    enabled: true
    baseline-on-migrate: true
    # locations: classpath:db/migration   # default, solo descomentá si lo cambiaste
    connect-retries: ${FLYWAY_CONNECT_RETRIES:10}
    connect-retries-interval: ${FLYWAY_RETRY_INTERVAL_SEC:5}

logging:
  level:
    root: INFO
    org.flywaydb: INFO
    com.zaxxer.hikari: INFO
    org.hibernate.SQL: WARN
